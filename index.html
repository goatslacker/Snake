<script type="text/javascript" src="prototype.js"></script>
<script type="text/javascript" src="snake.js"></script>
<script type="text/javascript" src="dreamcatcher.js"></script>

<script type="text/javascript">

  function loadViaLoop () {
    var dreams = [
      {
        title: "Time in school",
        dream: "I never spend much time in school but I taught ladies plenty. It's true I hire my body out for pay, hey hey. I've gotten burned over Cheryl Tiegs, blown up for Raquel Welch. But when I end up in the hay it's only hay, hey hey. I might jump an open drawbridge, or Tarzan from a vine. 'Cause I'm the unknown stuntman that makes Eastwood look so fine.",
        date_format: "09-09-09",
        timestamp: "1111111111",
        tags: ['school', 'vine', 'Eastwood', 'Tarzan', 'ladies']
      },
      {
        title: "My job",
        dream: "This is my boss, Jonathan Hart, a self-made millionaire, he's quite a guy. This is Mrs H., she's gorgeous, she's one lady who knows how to take care of herself. By the way, my name is Max. I take care of both of them, which ain't easy, 'cause when they met it was MURDER!",
        date_format: "07-07-07",
        timestamp: "1111111111",
        tags: ['boss,guy,gorgeous,lady,max']
      },
      {
        title: "The Unit",
        dream: "Ten years ago a crack commando unit was sent to prison by a military court for a crime they didn't commit. These men promptly escaped from a maximum security stockade to the Los Angeles underground. Today, still wanted by the government, they survive as soldiers of fortune. If you have a problem and no one else can help, and if you can find them, maybe you can hire the A-team.",
        date_format: "10-10-10",
        timestamp: "1111111111",
        tags: ['crack,', 'commando,', 'unit,', 'prison,', 'escaped']
      },
    ];

    var dream = null;
    for (var i = 0; i < dreams.length; i = i + 1) {
      dream = new Dream();
      dream.title = dreams[i].title;
      dream.summary = dreams[i].dream;
      dream.dream_date = dreams[i].date_format;
      dream.created_at = dreams[i].timestamp;

      dream.save(); // TODO should apply a dream.id!

      if (dreams[i].tags.length > 0) {
        for (var j = 0; j < dreams[i].tags.length; j = j + 1) {
          var tag = new DreamTag();
          tag.dream_id = dream.id;
          tag.tag = dreams[i].tags[j]; // TODO - cleanse the data
          tag.normalized = ""; // TODO extend function tag to always normalize
          tag.save();
        }
      }

    }

    // test
  }

  function insert () {
    var dream = new Dream();
    dream.summary = "Vivamus sed dapibus nibh. Integer sed arcu arcu, a sagittis nulla. Integer tortor eros, luctus vitae eleifend ultrices, dignissim non est. Sed volutpat varius metus nec tempor. Mauris at dui sit amet massa blandit suscipit. Aenean tempus leo ut dui sollicitudin quis rhoncus diam tincidunt. In ac suscipit quam. Pellentesque ut ornare nulla. Morbi accumsan hendrerit lectus ac ullamcorper.";
    dream.save();
  }

  function selectAll () {
    DreamPeer.doSelect(new Snake.Criteria(), function (dreams) {
      console.log(dreams);
    });
  }

  function selectWhere () {
    var c = new Snake.Criteria();
    c.add(DreamPeer.ID, 1);
    DreamPeer.doSelect(c, function (dream) {
      console.log(dream);
    });
  }

  function selectJoin () {
    var c = new Snake.Criteria();
    c.addJoin(DreamPeer.ID, DreamSearchPeer.DREAM_ID); // TODO test INNER_JOIN and RIGHT_JOIN
    DreamPeer.doSelect(c, function (dreams) {
      console.log(dreams);
    });
  }

  // TODO test selecting from a table with a foreign reference...
  // test loading a foreign object into object

  function update () {
    DreamPeer.doSelect(new Snake.Criteria(), function (dreams) {
      console.log(dreams);
      dreams[0].title = "Dream #5";
      dreams[0].save();
    });
  }

  Snake.ready(function () {
    //selectJoin();
    loadViaLoop();
  });
</script>
